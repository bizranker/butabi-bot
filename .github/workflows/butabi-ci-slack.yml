name: ðŸª© ButabiBot CI ðŸŽ¶

on:
  push:
    branches:
      - main

jobs:
  send-slack-message:
    runs-on: ubuntu-latest
    steps:
      - name: Format message
        id: format
        run: |
          MESSAGE=$(cat <<EOF
:disco_ball: *CI Disco Alert*
Stayinâ€™ alive... barely.  
:man_dancing: *John Travolta has entered the pipeline.*

*New push to* \`main\` ðŸŒ  
*Commit:* ${{ github.sha }}
*Message:* "${{ github.event.head_commit.message }}"

_â€œWhether you're a brother or whether you're a mother, you're pushinâ€™ to_ *main*.â€  
â€“ ButabiBot, Saturday Night DevOps
EOF
          )
          echo "DISCO_MESSAGE<<EOF" >> $GITHUB_ENV
          echo "$MESSAGE" >> $GITHUB_ENV
          echo "EOF" >> $GITHUB_ENV

      - name: Send message to Slack
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
          DISCO_MESSAGE: ${{ env.DISCO_MESSAGE }}
        run: |
          curl -X POST -H 'Content-type: application/json' \
            --data "{\"text\": \"$DISCO_MESSAGE\"}" \
            $SLACK_WEBHOOK_URL
