name: Disco Slack Alert

on:
  push:
    branches:
      - main

jobs:
  send-slack-message:
    runs-on: ubuntu-latest
    steps:
      - name: Format message
        run: |
          echo "DISCO_MESSAGE=ðŸ•º *John Travolta has entered the pipeline.* \\nðŸ’ƒ *New push to* \`main\` âœ¨ :mirror_ball:" >> $GITHUB_ENV

      - name: Send message to Slack
        run: |
          curl -X POST -H 'Content-type: application/json' \
          --data "{\"text\":\"ðŸª© *CI Disco Alert*\\nðŸŽ¶ Stayinâ€™ alive... barely.\\n$DISCO_MESSAGE\\n\\n> _'Whether you're a brother or whether you're a mother, you're pushin' to \`main\`.'_\\n> â€” *ButabiBot, Saturday Night DevOps*\"}" \
          $SLACK_WEBHOOK_URL
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
          DISCO_MESSAGE: ${{ env.DISCO_MESSAGE }}
